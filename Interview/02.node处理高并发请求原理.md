## node处理高并发请求原理

### 高并发策略 

通常的高并发策略的解决方案是提供多线程模型，服务器为每个客户端请求分配一个线程，使用同步IO，系统通过线程切换来弥补同步IO调用的时间开销。

但是当并发请求越多创建的线程越多，这样创建、销毁线程以及在线程间切换所需的开销也是非常大的。

nodejs采用了单线程模型来处理，不会为每一个请求分配一个线程，而是用一个主线程处理所有的请求，然后对IO操作进行一步处理，避开了创建、销毁线程以及在线程间切换所需的开销和复杂性。这就是为什么node适合IO密集型任务而不适合计算密集型任务。  

### node异步IO

异步IO是指操作系统提供的IO（数据进出）的能力，比如：磁盘的读写，DNS的查询，数据库的连接，网络请求的处理，等等；线程发出IO操作指令，然后就可以去做别的事情了（线程不需要等待），所有操作完成后再执行回调。

#### libuv 的IO线程池
nodejs中的异步I/O是通过底层的libuv提供的多线程的线程池来完成的。所以Node.js 的单线程仅仅是指 JavaScript 运行在单线程中，而并非 Node.js 是单线程。


IO线程执行IO操作时，会调用一个系统函数，生成一个请求包向内核传递，内核知道将这个I/O操作发送给哪个硬件设备。异步IO同时会传入一个回调函数随着请求包传递给设备驱动程序，然后IO线程返回线程池执行下一个IO事件。当异步I/O请求完成时，设备驱动程序就会生成一个I/O完成包，会由IO线程提取完成I/O的请求包，并将之前的回调函数推入node.js的task Queue中，等待事件循环将它推入主线程的执行栈执行。

